<div class="innercredits">

  <div class="credits-header">
    <h3>
      {{ creditName | replace("Pinheiro", "<span class='hide-mobile'>Pinheiro</span>") | safe }}
    </h3>
    
    <div class="sort-controls">
      <button class="sort-btn active" data-sort="latest">{% if locale == "en" %}Latest{% else %}Ãšltimos{% endif %}</button>
      <button class="sort-btn" data-sort="oldest">{% if locale == "en" %}Oldest{% else %}Primeiros{% endif %}</button>
      <button class="sort-btn" data-sort="az">A-Z</button>
      <button class="sort-btn" data-sort="za">Z-A</button>
    </div>
  </div>
  
  <div class="artwork gallery-grid">
  {% for item in creditList %}
    <a href="{{ item.link }}" 
      target="_blank" 
      rel="noopener noreferrer" 
      class="grid-item"
      data-date="{{ item.date }}" 
      data-artist="{{ item.artist }}">
      
      {% image "./src/_data/" + item.image, item.artist + " - " + item.work, "150px", "", "lazy", [450] %}
      <h3>{{ item.artist }}</h3>
      <h4>{{ item.work }}</h4>
      <p>{{ item.service }}<span>{{ item.date }}</span></p>
    </a>
  {% endfor %}
  </div>
</div>

<script>
document.addEventListener("DOMContentLoaded", function() {

  // 1. Helper: Parse "December 2025" into 202512
  const parseDate = (dateStr) => {
    if (!dateStr) return 0;
    const months = {
      "January": "01", "February": "02", "March": "03", "April": "04",
      "May": "05", "June": "06", "July": "07", "August": "08",
      "September": "09", "October": "10", "November": "11", "December": "12"
    };
    const parts = dateStr.split(" ");
    if (parts.length < 2) return 0;
    return parseInt(parts[1] + (months[parts[0]] || "00"));
  };

  // 2. Loop through each credit section
  const sections = document.querySelectorAll('.innercredits');

  sections.forEach(section => {
    const grid = section.querySelector('.gallery-grid');
    const buttons = section.querySelectorAll('.sort-btn');

    if (!grid || buttons.length === 0) return;

    // Get items safely
    const items = Array.from(grid.getElementsByClassName('grid-item'));

    // --- CORE SORT FUNCTION ---
    const runSort = (sortType) => {
      const sortedItems = items.sort((a, b) => {
        
        // Latest (Desc Date)
        if (sortType === 'latest') {
          const valA = parseDate(a.dataset.date);
          const valB = parseDate(b.dataset.date);
          if (valA !== valB) return valB - valA; // Big to Small
          return a.dataset.artist.localeCompare(b.dataset.artist); // Tie-break
        }

        // Oldest (Asc Date)
        if (sortType === 'oldest') {
          const valA = parseDate(a.dataset.date);
          const valB = parseDate(b.dataset.date);
          if (valA !== valB) return valA - valB; // Small to Big
          return a.dataset.artist.localeCompare(b.dataset.artist);
        }

        // A-Z
        if (sortType === 'az') {
          return a.dataset.artist.localeCompare(b.dataset.artist);
        }

        // Z-A
        if (sortType === 'za') {
          return b.dataset.artist.localeCompare(a.dataset.artist);
        }
      });

      // Clear and Re-append
      grid.innerHTML = "";
      sortedItems.forEach(item => grid.appendChild(item));
    };

    // --- CLICK HANDLERS ---
    buttons.forEach(btn => {
      btn.addEventListener('click', () => {
        // Visuals
        buttons.forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        
        // Logic
        runSort(btn.getAttribute('data-sort'));
      });
    });

    // --- AUTO-SORT ON LOAD ---
    // This ensures the list is sorted by "Latest" immediately when page opens
    runSort('latest');

  });
});
</script>