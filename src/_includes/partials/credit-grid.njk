<div class="innercredits">

  <div class="credits-header">
    <h3>
      {{ creditName | safe }}
    </h3>
    
    <div class="sort-controls">
      <button class="sort-btn active" data-sort="latest">{% if locale == "en" %}Latest{% else %}Últimos{% endif %}</button>
      <button class="sort-btn" data-sort="oldest">{% if locale == "en" %}Oldest{% else %}Primeiros{% endif %}</button>
      <button class="sort-btn" data-sort="az">A-Z</button>
      <button class="sort-btn" data-sort="za">Z-A</button>
    </div>
  </div>
  
  <div class="artwork gallery-grid">
  {% for item in creditList %}
    <a href="{{ item.link }}" 
      target="_blank" 
      rel="noopener noreferrer" 
      class="grid-item"
      data-date="{{ item.date }}" 
      data-artist="{{ item.artist }}">
      
      {% image "./src/_data/" + item.image, item.artist + " - " + item.work, "150px", "", "lazy", [450] %}
      <h3>{{ item.artist }}</h3>
      <h4>{{ item.work }}</h4>
      
      <p>{{ item.service }}
        <span>
          {% if locale == "en" %}
             {{ item.date }}
          {% else %}
             {{ item.date 
                | replace("January", "Janeiro")
                | replace("February", "Fevereiro")
                | replace("March", "Março")
                | replace("April", "Abril")
                | replace("May", "Maio")
                | replace("June", "Junho")
                | replace("July", "Julho")
                | replace("August", "Agosto")
                | replace("September", "Setembro")
                | replace("October", "Outubro")
                | replace("November", "Novembro")
                | replace("December", "Dezembro") 
             }}
          {% endif %}
        </span>
      </p>
    </a>
  {% endfor %}
  </div>
  <div class="scroll"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="#e3e3e3" viewBox="0 -960 960 960"><path d="M473-120q-20.15 0-37.92-7.46-17.77-7.46-32.46-22.16L205.54-346.15l19.23-18.7q9.08-8.3 20.58-10.73 11.5-2.42 23.27.5L380-347.62V-680q0-8.5 5.76-14.25t14.27-5.75q8.51 0 14.24 5.75T420-680v386.08l-145.46-39.31 156.61 155.85q8.08 8.07 19.09 12.73Q461.25-160 473-160h147q42.23 0 71.12-28.88Q720-217.77 720-260v-160q0-8.5 5.76-14.25t14.27-5.75q8.51 0 14.24 5.75T760-420v160q0 58.31-40.85 99.15-40.84 40.85-99 40.85H473Zm20.08-260v-160q0-8.54 5.75-14.27 5.76-5.73 14.27-5.73 8.52 0 14.25 5.75t5.73 14.25v160h-40Zm113.84 0v-120q0-8.54 5.76-14.27t14.27-5.73q8.51 0 14.24 5.75t5.73 14.25v120h-40Zm-46.15 105.38Zm279.23-390H664.62V-700H796q-68.31-55.69-148.15-90.54Q568-825.38 480-825.38t-167.85 34.84Q232.31-755.69 164-700h131.38v35.38H120V-840h35.38v100.23q71.24-54.38 153.24-87.69 82-33.31 171.38-33.31t171.38 33.31q82 33.31 153.24 87.69V-840H840v175.38Z"/></svg></div>
</div>

<script>
document.addEventListener("DOMContentLoaded", function() {

  // 1. Helper: Parse "December 2025" into 202512
  const parseDate = (dateStr) => {
    if (!dateStr) return 0;
    const months = {
      "January": "01", "February": "02", "March": "03", "April": "04",
      "May": "05", "June": "06", "July": "07", "August": "08",
      "September": "09", "October": "10", "November": "11", "December": "12"
    };
    const parts = dateStr.split(" ");
    if (parts.length < 2) return 0;
    return parseInt(parts[1] + (months[parts[0]] || "00"));
  };

  // 2. Loop through each credit section
  const sections = document.querySelectorAll('.innercredits');

  sections.forEach(section => {
    const grid = section.querySelector('.gallery-grid');
    const buttons = section.querySelectorAll('.sort-btn');

    if (!grid || buttons.length === 0) return;

    // Get items safely
    const items = Array.from(grid.getElementsByClassName('grid-item'));

    // --- CORE SORT FUNCTION ---
    const runSort = (sortType) => {
      const sortedItems = items.sort((a, b) => {
        
        // Latest (Desc Date)
        if (sortType === 'latest') {
          const valA = parseDate(a.dataset.date);
          const valB = parseDate(b.dataset.date);
          if (valA !== valB) return valB - valA; // Big to Small
          return a.dataset.artist.localeCompare(b.dataset.artist); // Tie-break
        }

        // Oldest (Asc Date)
        if (sortType === 'oldest') {
          const valA = parseDate(a.dataset.date);
          const valB = parseDate(b.dataset.date);
          if (valA !== valB) return valA - valB; // Small to Big
          return a.dataset.artist.localeCompare(b.dataset.artist);
        }

        // A-Z
        if (sortType === 'az') {
          return a.dataset.artist.localeCompare(b.dataset.artist);
        }

        // Z-A
        if (sortType === 'za') {
          return b.dataset.artist.localeCompare(a.dataset.artist);
        }
      });

      // Clear and Re-append
      grid.innerHTML = "";
      sortedItems.forEach(item => grid.appendChild(item));
      grid.scrollTo({
        left: 0,
        behavior: 'smooth'
      });
    };

    // --- CLICK HANDLERS ---
    buttons.forEach(btn => {
      btn.addEventListener('click', () => {
        // Visuals
        buttons.forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        
        // Logic
        runSort(btn.getAttribute('data-sort'));
      });
    });

    // --- AUTO-SORT ON LOAD ---
    // This ensures the list is sorted by "Latest" immediately when page opens
    runSort('latest');

  });
});
document.addEventListener("DOMContentLoaded", function() {
  
  // 1. Select ALL artwork containers and ALL scroll labels
  const allArtworks = document.querySelectorAll('.artwork');
  const allLabels = document.querySelectorAll('.scroll');

  // 2. Define the "Master Switch" function
  // This will run once and update EVERYTHING at the same time
  const triggerGlobalUpdate = () => {
      
      // Hide ALL scroll labels
      allLabels.forEach(label => {
          label.classList.add('is-hidden');
      });

      // Update ALL artwork containers (add class for padding change)
      allArtworks.forEach(art => {
          art.classList.add('has-scrolled');
      });
  };

  // 3. Add the listener to every artwork container
  // If ANY of them is scrolled, they trigger the global function
  allArtworks.forEach(container => {
      container.addEventListener('scroll', triggerGlobalUpdate, { once: true });

      // Check immediately if this specific container is already scrolled (e.g. refresh)
      if (container.scrollLeft > 0 || container.scrollTop > 0) {
          triggerGlobalUpdate();
      }
  });
});
</script>